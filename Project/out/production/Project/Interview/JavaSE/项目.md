# 软件包管理

## 概述

1. 实现一个软件包管理仓库，管理微服务软件包。 主要功能为前端上传软件包、经过校验之后， 将成功上传的软件包进行解压， 解析软件包元信息以及相关的服务依赖和数据依赖， 在硬盘上备份软件包， 将信息存入数据库中。同时使用 java 操作 docker 客户端，将软件包中的镜像文件上传至 harbor 中。 

2. 在软件包仓库的基础上使用 NIO 实现网络通信，将软件包在多个服务中心上根据不同的同步规则进行同步。

## 特点

同步传输服务使用了帧封装+责任链模式

## 难点

### 断点续传+文件切分

**问题**：重连后怎么知道刚才发了多少？如何记录这个过程？客户端断电后有易失性，接收端也有易失性如何处理？

**方案**：

**单线程下的断点续传**：

1. 客户端先发一个头帧，然后服务端检测是否有这个文件，文件里写了多少信息，返回当前状态给发送端。
2. 发送端根据接收端反馈的信息从断点处继续发送剩余的帧，追加写入，直至发送完毕。可以用名称标记为临时文件先保存，传输完毕再重命名回去。

**多线程大文件拆分加断点续传**：

**RandomAccessFile**指定任意位置读写，根据帧序号*帧长找到写入位置。

1. 文件被划分为帧传输。客户端发送头帧，获得对端接收情况，根据bitmap返回的字符串，做与运算，找到未被接收的帧。然后new一个阻塞队列记录这些未接收帧。
2. 多个线程都从阻塞队列中找到一个未被传输的，使用随机读取发送这个帧。直到阻塞队列为空，线程都被阻塞。

