# 基础功能

## 1. 服务治理： Spring Cloud Eureka

### 概述

创建一个服务中心，用来注册服务。其他的服务都向这个服务中心注册，服务中心也是一个服务，互相之间也能注册维持高可用。

Eureka专门用于给其他服务注册的称为Eureka Server(服务注册中心)，其余注册到Eureka Server的服务称为Eureka Client。

Eureka Client**分为服务提供者和服务消费者**。如果是单纯的不提供服务只是消费则可以不用注册到服务中心，但是依然可以使用服务中心的服务。

### 治理机制

- 服务提供者

- - **服务注册：启动的时候会通过发送REST请求的方式将自己注册到Eureka Server上**，同时带上了自身服务的一些元数据信息。
  - **服务续约：**在注册完服务之后，**服务提供者会维护一个心跳**用来持续告诉Eureka Server: "我还活着 ” 、
  - **服务下线：当服务实例进行正常的关闭操作时，它会触发一个服务下线的REST请求**给Eureka Server, 告诉服务注册中心：“我要下线了 ”。

- 服务消费者

- - **获取服务：当我们启动服务消费者**的时候，它会发送一个REST请求给服务注册中心，来获取上面注册的服务清单
  - **服务调用：服务消费者在获取服务清单后，通过服务名**可以获得具体提供服务的实例名和该实例的元数据信息。在进行服务调用的时候，**优先访问同处一个Zone中的服务提供方**。使用spring自带的resttemplate进行服务消费。

- Eureka Server(服务注册中心)：

- - **失效剔除：**默认每隔一段时间（默认为60秒） 将当前清单中超时（默认为90秒）**没有续约的服务剔除出去**。
  - **自我保护：**EurekaServer 在运行期间，会统计心跳失败的比例，当心跳失败比例较高（可能由于网络不稳定导致），Eureka Server会将当前的**实例注册信息保护起来**， 让这些实例不会过期，尽可能**保护这些注册信息**。

### 优点

只需要通过服务名调用相关服务，不需要维护静态的ip信息。

## 2. 客户端负载均衡： Spring Cloud Ribbon

负载均衡又区分了两种类型：

- 客户端负载均衡(Ribbon)

  * 服务实例的**清单在客户端**，客户端进行负载均衡算法分配。

  - (从上面的知识我们已经知道了：客户端可以从Eureka Server中得到一份服务清单，在发送请求时通过负载均衡算法，**在多个服务器之间选择一个进行访问**)

- 服务端负载均衡(Nginx)

  * 服务实例的**清单在服务端**，服务器进行负载均衡算法分配


Ribbon是支持负载均衡，默认的负载均衡策略是**轮询**，我们也是可以根据自己实际的需求自定义负载均衡策略的。

## 3.服务容错保护： Spring Cloud Hystrix

## 4.声明式服务调用： Spring Cloud Feign

## 5.API网关服务：Spring Cloud Zuul

## 6.分布式配置中心： Spring Cloud Config